{"version":3,"sources":["../../../src/redux/reducers/config.js"],"names":["Joi","require","chalk","_","gatsbyConfigSchema","module","exports","state","action","type","result","validate","payload","error","console","log","blue","bgYellow","bold","red","linkPrefix","Error","pathPrefix","startsWith","endsWith","slice","has","set"],"mappings":";;;;;;;;AAAA,IAAMA,MAAMC,QAAS,KAAT,CAAZ;AACA,IAAMC,QAAQD,QAAS,OAAT,CAAd;AACA,IAAME,IAAIF,QAAS,QAAT,CAAV;;eAE+BA,QAAS,uBAAT,C;IAAvBG,kB,YAAAA,kB;;AAERC,OAAOC,OAAP,GAAiB,YAAwB;AAAA,MAAvBC,KAAuB,uEAAf,EAAe;AAAA,MAAXC,MAAW;;AACvC,UAAQA,OAAOC,IAAf;AACE,SAAM,iBAAN;AAAwB;AACtB;AACA,YAAMC,SAASV,IAAIW,QAAJ,CAAaH,OAAOI,OAApB,EAA6BR,kBAA7B,CAAf;AACA;AACA;AACA;AACA,YAAIM,OAAOG,KAAX,EAAkB;AAChBC,kBAAQC,GAAR,CACEb,MAAMc,IAAN,CAAWC,QAAX,CAAqB,+CAArB,CADF;AAGAH,kBAAQC,GAAR,CAAYb,MAAMgB,IAAN,CAAWC,GAAX,CAAeT,OAAOG,KAAtB,CAAZ;AACA,cAAIL,OAAOI,OAAP,CAAeQ,UAAnB,EAA+B;AAC7BN,oBAAQC,GAAR,CAAa,gDAAb;AACD;AACD,gBAAM,IAAIM,KAAJ,CAAW,+CAAX,CAAN;AACD;;AAED;AACA;AACA,YAAIb,OAAOI,OAAP,IAAkBJ,OAAOI,OAAP,CAAeU,UAArC,EAAiD;AAC/C,cAAI,CAACnB,EAAEoB,UAAF,CAAaf,OAAOI,OAAP,CAAeU,UAA5B,EAAyC,GAAzC,CAAL,EAAmD;AACjDd,mBAAOI,OAAP,CAAeU,UAAf,GAA6B,IAAGd,OAAOI,OAAP,CAAeU,UAAW,EAA1D;AACD;AACD,cAAInB,EAAEqB,QAAF,CAAWhB,OAAOI,OAAP,CAAeU,UAA1B,EAAuC,GAAvC,CAAJ,EAAgD;AAC9Cd,mBAAOI,OAAP,CAAeU,UAAf,GAA4Bd,OAAOI,OAAP,CAAeU,UAAf,CAA0BG,KAA1B,CAAgC,CAAhC,EAAmC,CAAC,CAApC,CAA5B;AACD;AACF;;AAED;AACA;AACA,YAAI,CAACtB,EAAEuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,CAAL,EAA+C;AAC7CA,mBAASL,EAAEwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,EAA0C,EAA1C,CAAT;AACD;;AAED;AACA,YAAI,CAACL,EAAEuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,CAAL,EAA6C;AAC3CA,mBAASL,EAAEwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,EAAuC,IAAvC,CAAT;AACD;;AAED,0CACKA,OAAOI,OADZ;AAGD;AACD;AACE,aAAOL,KAAP;AA7CJ;AA+CD,CAhDD","file":"config.js","sourcesContent":["const Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\n\nconst { gatsbyConfigSchema } = require(`../../joi-schemas/joi`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_SITE_CONFIG`: {\n      // Validate the config.\n      const result = Joi.validate(action.payload, gatsbyConfigSchema)\n      // TODO use Redux for capturing errors from different\n      // parts of Gatsby so a) can capture richer errors and b) be\n      // more flexible how to display them.\n      if (result.error) {\n        console.log(\n          chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`)\n        )\n        console.log(chalk.bold.red(result.error))\n        if (action.payload.linkPrefix) {\n          console.log(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n        }\n        throw new Error(`The site's gatsby-config.js failed validation`)\n      }\n\n      // Ensure that the pathPrefix (if set) starts with a forward slash\n      // and doesn't end with a slash.\n      if (action.payload && action.payload.pathPrefix) {\n        if (!_.startsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = `/${action.payload.pathPrefix}`\n        }\n        if (_.endsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = action.payload.pathPrefix.slice(0, -1)\n        }\n      }\n\n      // If pathPrefix isn't set, set it to an empty string\n      // to avoid it showing up as undefined elsewhere.\n      if (!_.has(action, [`payload`, `pathPrefix`])) {\n        action = _.set(action, [`payload`, `pathPrefix`], ``)\n      }\n\n      // Default polyfill to true.\n      if (!_.has(action, [`payload`, `polyfill`])) {\n        action = _.set(action, [`payload`, `polyfill`], true)\n      }\n\n      return {\n        ...action.payload,\n      }\n    }\n    default:\n      return state\n  }\n}\n"]}